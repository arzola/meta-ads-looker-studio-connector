# Looker Studio Connector for Meta Ads

This Google Apps Script project provides a community connector for Google Looker Studio (formerly Data Studio) to fetch core performance data directly from the Meta (Facebook) Ads Marketing API.

## Overview

This connector allows you to:

*   Connect Looker Studio to your Meta Ad Account(s).
*   Automatically fetch key metrics: `Spend (Cost)` and `Total Conversion Value (for purchases)`.
*   Automatically fetch key dimensions: `Date` and `Campaign Name`.
*   Define date ranges for the data you want to analyze within Looker Studio.
*   Visualize your Meta Ads performance data within Looker Studio dashboards.

The connector is designed for simplicity, providing a fixed set of essential fields. More complex metrics (like ROAS, CPC, CTR) should be calculated directly within Looker Studio using the base fields provided by this connector.

## Prerequisites

1.  **Google Account:** To use Google Apps Script and Looker Studio.
2.  **Meta Developer Account:** To create a Meta App and get API credentials.
3.  **Meta Ad Account:** Access to the Ad Account ID(s) you want to pull data from (you'll input the numerical part).
4.  **Permissions:** Sufficient permissions within the Meta Ad Account to read insights (`ads_read`, `read_insights`).

## Setup Instructions

Follow these steps to set up and deploy the connector:

**1. Google Apps Script Setup:**

*   Go to Google Apps Script: [https://script.google.com/home](https://script.google.com/home)
*   Create a new project.
*   Copy the entire content of the `Code.gs` file provided in this repository and paste it into the editor, replacing any default code.
*   **Important:** Add the required `OAuth2` library:
    *   In the script editor, click on "Libraries" (+) in the left sidebar.
    *   In the "Find a Library" field, paste the Script ID for the OAuth2 library: `1B7FSrk5Zi6L1rSxxTDgDEUsPzlukDsi4KGuTMorsTQHhGBzBkMun4iDF`
    *   Click "Search".
    *   Select the "OAuth2" library (usually the latest version is fine).
    *   Click "Add".

**2. Meta Developer App Setup:**

*   Go to the Meta for Developers portal: [https://developers.facebook.com/](https://developers.facebook.com/)
*   Create a new App (or use an existing one). Choose "Business" as the app type.
*   Navigate to "App Settings" > "Basic". Note down your **App ID** (this will be your Client ID) and **App Secret** (Client Secret).
*   Add the "Marketing API" product to your app from the "Add products" section.
*   Configure OAuth Settings:
    *   Go to the "Marketing API" product settings > "Settings".
    *   In the "Valid OAuth Redirect URIs" section, you need to add a specific URI generated by Apps Script. To find this:
        *   Go back to your Apps Script editor.
        *   Run the `get3PAuthorizationUrls` function once (Select function > Run). It might ask for authorization; grant it.
        *   Go to "View" > "Logs". Find the URL logged that ends with `/usercallback`. Copy this **entire URL**.
        *   Paste this URL into the "Valid OAuth Redirect URIs" field in your Meta App settings.
    *   Make sure your app is in **Live** mode (toggle at the top of the Meta Developer dashboard). You might need to complete data use checkups or other requirements from Meta.

**3. Script Properties Configuration:**

*   In your Apps Script project, go to "Project Settings" (gear icon ⚙️ in the left sidebar).
*   Scroll down to the "Script Properties" section.
*   Click "Edit script properties".
*   Add two properties:
    *   **Property:** `META_CLIENT_ID` | **Value:** Your Meta App ID
    *   **Property:** `META_CLIENT_SECRET` | **Value:** Your Meta App Secret
*   Click "Save script properties".

**4. Deployment:**

*   In the Apps Script editor, click "Deploy" > "New deployment".
*   Select type: "Web app".
*   Configure the deployment:
    *   **Description:** (Optional) e.g., "Meta Ads Connector V2 (Simplified)"
    *   **Execute as:** "Me"
    *   **Who has access:** "Anyone with Google account" (or restrict if necessary, but this usually works best for Looker Studio).
*   Click "Deploy".
*   **Authorize access:** Grant the necessary permissions for the script to run. Review the permissions carefully.
*   After deployment, you'll get a **Deployment ID**. Copy this ID – you will need it for Looker Studio. **Do not use the Web App URL.**

## Usage Instructions

**1. Connecting in Looker Studio:**

*   Go to Looker Studio: [https://lookerstudio.google.com/](https://lookerstudio.google.com/)
*   Create a new "Data Source".
*   Search for "Build Your Own" connector or look under the "Partner Connectors" section.
*   When prompted for a Deployment ID, paste the **Deployment ID** you copied during the Apps Script deployment step.
*   Click "Validate".
*   **Authorize:** You will likely be prompted to authorize both the connector script and access to your Meta account via the OAuth flow you configured. Follow the prompts.

**2. Configuration:**

*   Once authorized, you will see a simplified configuration:
    *   **Ad Account ID Number:** Enter *only the numerical part* of your Meta Ad Account ID (e.g., `1234567890`). **This is required.**
*   Click "Connect" in the top right corner.

**3. Available Fields & Creating Your Report:**

*   The connector automatically provides the following fields:
    *   **Dimensions:**
        *   `Date` (date_start)
        *   `Campaign Name` (campaign_name)
    *   **Metrics:**
        *   `Spend (Cost)` (spend)
        *   `Total Conversion Value` (conversion_value_total - based on "purchase" actions)
*   You can now use this data source in your Looker Studio reports.
*   **Important for ROAS and other ratio metrics:**
    *   To calculate ROAS (Return on Ad Spend), create a calculated field in Looker Studio:
        *   Formula: `SUM(Total Conversion Value) / SUM(Spend (Cost))`
        *   Type: Number (e.g., 2.5) or Percent (e.g., 250%)
    *   Similarly, calculate other metrics like CPC, CPM, CTR using the base fields provided if needed.

## Authentication

*   This connector uses OAuth2 for authentication with the Meta Marketing API.
*   Your access token is stored securely using Google Apps Script's `PropertiesService` (specifically `UserProperties`).
*   If you encounter authentication errors, you may need to re-authenticate the data source in Looker Studio or reset the authorization using the `resetAuth` function in Apps Script (run manually from the editor) and then re-authorize in Looker Studio.

## Limitations & Known Issues

*   **API Quotas:** Be mindful of Meta Marketing API rate limits.
*   **Pagination Limit:** The script currently fetches a maximum of 100 pages of data from the API to prevent timeouts. If your query returns more data, it might be incomplete.
*   **Action Specificity:** `Total Conversion Value` and `Actions` metrics are based specifically on "purchase" action types reported by the API.
*   **Data Freshness:** Data is fetched when Looker Studio requests it. Configure data freshness settings in your Looker Studio data source.

## Troubleshooting

*   **Authorization Errors:** Double-check your `META_CLIENT_ID` and `META_CLIENT_SECRET` in Script Properties. Ensure the Redirect URI in your Meta App settings exactly matches the one logged by `get3PAuthorizationUrls`. Make sure your Meta App is Live. Try running `resetAuth()` and re-authorizing.
*   **Missing Data / Errors in Report:**
    *   Check the Apps Script project logs ("Executions" in the left sidebar) for detailed error messages from the script or the Meta API.
    *   Verify the Ad Account ID is correct and you have `ads_read`/`read_insights` permissions.
    *   Test with a smaller date range in Looker Studio.
*   **`Configuration Error: ...`:** Check the `validateConfig` function logic. The primary validation is for a correctly formatted numerical "Ad Account ID".
*   **`Meta API Error: ...`:** These errors come directly from Facebook. Check the Meta Marketing API documentation or status pages for information related to the error code or message. It could be permissions, an invalid account ID, or temporary API issues. 